<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Private session management using OIDC | Modyo Front End Documentation</title>
    <meta name="description" content="Welcome to the ModyoFront End Center&quot;">
    <link rel="apple-touch-icon" sizes="180x180" href="/front-docs/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/front-docs/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/front-docs/favicon-16x16.png">
  <link rel="manifest" href="/front-docs/site.webmanifest">
  <link rel="mask-icon" href="/front-docs/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="apple-mobile-web-app-title" content="Modyo">
  <meta name="application-name" content="Modyo">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">
  <meta name="msapplication-TileImage" content="/mstile-150x150.png">
  <meta name="msapplication-TileColor" content="#da532c">
    
    <link rel="preload" href="/front-docs/assets/css/0.styles.0a022410.css" as="style"><link rel="preload" href="/front-docs/assets/js/app.0ca6469d.js" as="script"><link rel="preload" href="/front-docs/assets/js/2.e9667b33.js" as="script"><link rel="preload" href="/front-docs/assets/js/8.6b8d2bef.js" as="script"><link rel="preload" href="/front-docs/assets/js/3.55cf4934.js" as="script"><link rel="prefetch" href="/front-docs/assets/js/10.2965d40b.js"><link rel="prefetch" href="/front-docs/assets/js/11.3c261822.js"><link rel="prefetch" href="/front-docs/assets/js/12.091fd555.js"><link rel="prefetch" href="/front-docs/assets/js/4.8c0208bb.js"><link rel="prefetch" href="/front-docs/assets/js/5.f49bb34d.js"><link rel="prefetch" href="/front-docs/assets/js/6.c278a211.js"><link rel="prefetch" href="/front-docs/assets/js/7.e2f05d14.js"><link rel="prefetch" href="/front-docs/assets/js/9.176d7691.js">
    <link rel="stylesheet" href="/front-docs/assets/css/0.styles.0a022410.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-docs/en/" class="home-link router-link-active"><img src="/front-docs/assets/img/modyo.png" alt="Modyo Front End Documentation" class="logo"> <span class="site-name can-hide">Modyo Front End Documentation</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-docs/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-docs/integrations/OIDC/" class="nav-link">Español</a></li><li class="dropdown-item"><!----> <a href="/front-docs/en/integrations/OIDC/" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-docs/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-docs/integrations/OIDC/" class="nav-link">Español</a></li><li class="dropdown-item"><!----> <a href="/front-docs/en/integrations/OIDC/" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/front-docs/en/integrations/" class="sidebar-link">Integrations</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Articles</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-docs/en/integrations/OIDC/" class="active sidebar-link">Private session management using OIDC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#make-the-site-private" class="sidebar-link">Make the site private</a></li><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#enable-account-level-integration-for-all-sites" class="sidebar-link">Enable account level integration (for all sites)</a></li><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#using-axios-to-do-the-integration" class="sidebar-link">Using Axios to do the integration</a></li><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#intercept-requests-to-include-a-token" class="sidebar-link">Intercept requests to include a token</a></li><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#a-session-controller" class="sidebar-link">A session controller</a></li><li class="sidebar-sub-header"><a href="/front-docs/en/integrations/OIDC/#a-modal-window-that-informs-the-user-that-their-session-will-expire" class="sidebar-link">A modal window that informs the user that their session will expire</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="private-session-management-using-openid-connect-oidc"><a href="#private-session-management-using-openid-connect-oidc" class="header-anchor">#</a> Private session management using OpenID Connect (OIDC)</h1> <p>The recommended method to interact with a private API using the Modyo session with an OIDC integration, basically consists of two steps: <strong>make the site private</strong> and <strong>enable integration at the account level</strong>.</p> <h2 id="make-the-site-private"><a href="#make-the-site-private" class="header-anchor">#</a> Make the site private</h2> <ol><li>Log in to the account where you want to create the private site.</li> <li>Click on create a new site.</li> <li>Assign a name to the new site and select the base theme.</li> <li>In the <code>configuration&gt; site</code> section, under the <strong>Restrictions</strong> tab, we select <strong>private</strong>. It also activates <strong>Show home to public visits</strong> to be able to redirect users without a session.</li></ol> <h2 id="enable-account-level-integration-for-all-sites"><a href="#enable-account-level-integration-for-all-sites" class="header-anchor">#</a> Enable account level integration (for all sites)</h2> <ol><li>Go to the account, <strong>Customers</strong> and from there to the <strong>Settings</strong> section and then the <strong>Integration</strong> tab</li> <li>Select the OpenID Connect integration and check the box for <strong>Enable OpenID Connect</strong></li> <li>Fill in the data for <strong>Service name, Client ID, Secret and Issuer</strong> and click <strong>Launch discovery service</strong></li> <li>Check the fields you need (Enable refresh token, Enable remote logout, Enable token revocation, Enable claims synchronization)</li> <li>Associate the provider fields with the custom fields you have in Modyo <a href="http://openid.net/specs/openid-connect-core-1_0.html#StandardClaims" target="_blank" rel="noopener noreferrer">OpenID Connect 1.0 specification for Standard Claims<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <h2 id="using-axios-to-do-the-integration"><a href="#using-axios-to-do-the-integration" class="header-anchor">#</a> Using Axios to do the integration</h2> <p>If you want to use a library as <code>axios</code> to perform an integration from Modyo, a convenient pattern is to create 3 snippets that take care of the most basic aspects of an integration.</p> <p>The tasks you must cover with snippets are:</p> <ol><li>A request interceptor to include a token.</li> <li>A session controller.</li> <li>A modal window that informs the user that their session will expire.</li></ol> <h2 id="intercept-requests-to-include-a-token"><a href="#intercept-requests-to-include-a-token" class="header-anchor">#</a> Intercept requests to include a token</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// global variable that represents an instance of axios that will be in charge of making the service requests</span>
<span class="token keyword">var</span> axios_api <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  axios_api<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'URL DE API'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// global variable that will represent an instance of axios that will be responsible for making the requests of the modyo api</span>
<span class="token keyword">var</span> axios_modyo<span class="token operator">=</span>axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token punctuation">:</span> window<span class="token punctuation">.</span>baseUrl <span class="token operator">+</span> <span class="token string">'/api/v1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// variable global que representara una instancia de axios que se encargará de hacer las peticiones los json de contenido del sitio</span>
<span class="token keyword">var</span> axios_modyo_json<span class="token operator">=</span>axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>site<span class="token punctuation">.</span>url<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// global variable that represents an axios instance that will be responsible for making authentication-related requests</span>
<span class="token keyword">var</span> axios_auth <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
axios_auth<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> window<span class="token punctuation">.</span>baseUrl <span class="token operator">+</span> <span class="token string">'/auth/openidc'</span><span class="token punctuation">;</span>
<span class="token comment">// function that generates activity on the site with each authentication request</span>
<span class="token keyword">var</span> <span class="token function-variable function">resetIdleTime</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  sessionManager<span class="token punctuation">.</span><span class="token function">resetIdleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// function that adds the token to each of the request</span>
<span class="token keyword">var</span> <span class="token function-variable function">appendTokenToRequest</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> axios_auth<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/access_token'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token operator">=</span><span class="token string">'Bearer '</span><span class="token operator">+</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token<span class="token punctuation">;</span>
		<span class="token keyword">return</span> request<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// function that handles the errors of each of the requests and sends them to a higher instance</span>
<span class="token keyword">var</span> <span class="token function-variable function">errorRequest</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
axios_auth<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>resetIdleTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
axios_api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>appendTokenToRequest <span class="token punctuation">,</span>errorRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="a-session-controller"><a href="#a-session-controller" class="header-anchor">#</a> A session controller</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// will be responsible for raising the warning modality that warns the close of the session, this variable will return a promise that will be effective if you click on the Hold Session button and will launch a reject promise in the case of selecting the button with the negative to continue</span>
<span class="token keyword">var</span> <span class="token function-variable function">modalConfirm</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      backdrop<span class="token punctuation">:</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span>
      keyboard<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      show<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal-yes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;keep session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">&quot;hide&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal-no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;destroy session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">&quot;hide&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// It will be the one that will be responsible for starting the time tracking to lift this modal and handle the Front side of the session, then we will explain each of the properties and methods of this object that handles the session</span>
<span class="token keyword">var</span> sessionManager <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// property that defines the time from the last activity until the end of the session in seconds (note not the refresh time of the token but the end of the session, it is recommended that this be one minute shorter than the one declared by the provider of the Open ID Connect to have a little slack with the session and closing it is 100% valid)</span>
  timeToEndSessionInSeconds<span class="token punctuation">:</span> <span class="token number">900</span><span class="token punctuation">,</span>
  <span class="token comment">// property where the lifting time of the inactivity modal is defined since the last action or request on the page</span>
  timeToRaiseWarningModalInSeconds<span class="token punctuation">:</span> <span class="token number">720</span><span class="token punctuation">,</span>
  <span class="token comment">// property that saves the timestamp of the last moment of activity of the sessionManager</span>
  lastActionTimeInThisWindow<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// function that converts seconds to milliseconds</span>
  <span class="token function-variable function">secondsToMilisecs</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">minutes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> minutes <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// property to store the session id interval review session</span>
  intevalId<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// function that determines if the application is being accessed from the modyoShell or not</span>
  <span class="token function-variable function">isModyoAppShell</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">/</span><span class="token punctuation">;</span> Modyo_App_Shell<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// method that must be executed on each page load to begin the process of session events to follow up recommended do this invocation sessionManager.init () in the head of the layout to begin tracking the session (in some cases it will be defined that the developers do not launch this invocation in that case the test api to connect us must also have this if and so we will achieve that axios_api serves for the develop and development environment one with session and the other without session manager)</span>
  <span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetIdleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intevalId<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// reset the idle time or create a new activity on the site</span>
  <span class="token function-variable function">resetIdleTime</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lastActionTimeInThisWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sessionEndTime <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastActionTimeInThisWindow <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">secondsToMilisecs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeToEndSessionInSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;timeToEndSession&quot;</span><span class="token punctuation">,</span> sessionEndTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> raiseWarningModalTime <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastActionTimeInThisWindow <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">secondsToMilisecs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeToRaiseWarningModalInSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;timeToRaiseWarningModal&quot;</span><span class="token punctuation">,</span> raiseWarningModalTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// method that initiates the activity every second js that will handle the session events</span>
  <span class="token function-variable function">interval</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>checkSessionEvents<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// method that raises the warning time modal</span>
  <span class="token function-variable function">raiseModal</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">modalConfirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// logout method and clean storage and clear interval functions that checks session events</span>
  <span class="token function-variable function">logout</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>intevalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> withRedirect <span class="token operator">=</span>
      arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>withRedirect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span>
        <span class="token string">&quot;{{site.account_url}}/logout?multi=true&amp;redirect_to=https://chile.larrainvial.com&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;{{site.account_url}}/logout?site={{site.uuid}}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// method that reviews session events to determine if it is time to close it or keep it after showing the modal</span>
  <span class="token function-variable function">checkSessionEvents</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sessionEndTime <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;timeToEndSession&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> raiseWarningModalTime <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;timeToRaiseWarningModal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> diffInSecsToShow <span class="token operator">=</span>
      Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sessionEndTime <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
        <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sessionEndTime <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> expirationTimeHtml <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#expiration-time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> timeNow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    expirationTimeHtml<span class="token punctuation">.</span>innerText <span class="token operator">=</span> diffInSecsToShow<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionEndTime <span class="token operator">-</span> timeNow <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>raiseWarningModalTime <span class="token operator">-</span> timeNow <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self
        <span class="token punctuation">.</span><span class="token function">raiseModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          axios_auth<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">&quot;bs.modal&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_isShown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#session-modal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">&quot;hide&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="a-modal-window-that-informs-the-user-that-their-session-will-expire"><a href="#a-modal-window-that-informs-the-user-that-their-session-will-expire" class="header-anchor">#</a> A modal window that informs the user that their session will expire</h2> <p>This would be the modal to activate in the previous step with bootstrap for handling the warning modal.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>session-modal<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal fade<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dialog<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>session-modal-label<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-dialog<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>document<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>session-modal-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          Your session will expire soon
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-body text-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
          Your session will expire in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>expiration-time<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> seconds.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Do you want to keep your session?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal-footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>session-modal-yes<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          Yes
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>session-modal-no<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn btn-secondary<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">data-dismiss</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
          No
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/4/2019, 5:52:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front-docs/en/integrations/" class="prev router-link-active">Integrations</a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/front-docs/assets/js/app.0ca6469d.js" defer></script><script src="/front-docs/assets/js/2.e9667b33.js" defer></script><script src="/front-docs/assets/js/8.6b8d2bef.js" defer></script><script src="/front-docs/assets/js/3.55cf4934.js" defer></script>
  </body>
</html>
